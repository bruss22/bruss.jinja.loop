{# Script #2: Physical Interface Build Script For FMG. Save as CLI Jinja Template and import Script #1 #}
{% import 'main' as nets with context -%}
{% for x in nets.nets -%}
{% if x.name is defined -%}
{# Check if variable is host -#}
{% if x.subnet | ipaddr('host') -%}
config system interface
    edit {{x.port}}
        set vdom "root"
        set ip {{x.subnet|ipaddr('address')}} {{x.subnet|ipaddr('netmask')}}
        set allowaccess ping
		set vrf {{x.vrf}}
        set description {{x.subnet}} is host in {{x.subnet|ipaddr('network/prefix')}}
    next
end
{# Check if variable is network -#}
{% elif x.subnet | ipaddr('network') -%}
config system interface
    edit {{x.port}}
        set vdom "root"
        set ip {{x.subnet|ipaddr(1)|ipaddr('address')}} {{x.subnet|ipaddr('netmask')}}
        set allowaccess ping
		set vrf {{x.vrf}}
        set description {{x.subnet}} is network {{x.subnet|ipaddr('network/prefix')}}
    next
end
{% endif -%}
{% if x.dhcp == 'y' -%}
config system dhcp server
    edit {{x.netid}}
        set interface {{x.port}}
        set dns-service default
        set default-gateway {{x.subnet| ipaddr('subnet') | ipaddr(1) | ipaddr('address') }}
        set netmask {{x.subnet| ipaddr('netmask')}}
        {% if x.subnet| ipaddr('size_usable') >= 62 -%}
          config ip-range
            edit 1
              set start-ip {{x.subnet| ipaddr('subnet') | ipaddr(+20) | ipaddr('address') }}
              set end-ip {{ x.subnet | ipaddr('subnet') | ipaddr(-2) | ipaddr('address') }}
        {% elif x.subnet| ipaddr('size_usable') <= 62 -%}
          config ip-range
            edit 1
              set start-ip {{x.subnet| ipaddr('subnet') | ipaddr(+3) | ipaddr('address') }}
              set end-ip {{ x.subnet | ipaddr('subnet') | ipaddr(-2) | ipaddr('address') }}
        {% endif -%}
              next
        end
   next
end
{% endif -%}
{% endif -%}
{% endfor -%}
